@inject GameService gameServiceInstance;

<svg width="300" height="300"
     @onmouseover="OnMouseOver"
     @onmouseout="OnMouseOut"
     @onclick="OnClick"
     xmlns="http://www.w3.org/2000/svg">
    <rect style="cursor:@cursor;"
          x="@X"
          y="@Y"
          width="@Width"
          height="@Height"
          fill="@fillColor"
          stroke="black"
          stroke-width="1" />

    @if (CellData != null && CellData.Player == Models.Player.X)
    {
        <svg width="@Width" height="@Width" x="@X" y="@Y" viewBox="0 0 32 32">
            <path fill="#1967AC" fill-opacity="1" stroke-width="0.32" stroke-linejoin="round" d="M 3.55492,26.1823L 13.7373,16L 3.55493,5.81766L 5.81767,3.55492L 16,13.7373L 26.1823,3.55492L 28.4451,5.81766L 18.2627,16L 28.4451,26.1823L 26.1823,28.4451L 16,18.2627L 5.81766,28.4451L 3.55492,26.1823 Z " />
        </svg>
    }
    else @if (CellData != null && CellData.Player == Models.Player.O)
{
<svg width="@Width" height="@Width" x="@X" y="@Y" viewBox="0 0 32 32">
    <path fill="#1967AC" fill-opacity="1" stroke-width="0.32" stroke-linejoin="round" d="M 16,1.36001C 24.0854,1.36001 30.64,7.91457 30.64,16C 30.64,24.0855 24.0854,30.64 16,30.64C 7.91455,30.64 1.36,24.0855 1.36,16C 1.36,7.91456 7.91455,1.36001 16,1.36001 Z M 16,3.94002C 9.33944,3.94002 3.94,9.33946 3.94,16C 3.94,22.6606 9.33944,28.06 16,28.06C 22.6605,28.06 28.06,22.6606 28.06,16C 28.06,9.33946 22.6605,3.94002 16,3.94002 Z " />
</svg>
}
</svg>

@code{
    [Parameter] public int Width { get; set; }
    [Parameter] public int Height { get; set; }
    [Parameter] public int X { get; set; }
    [Parameter] public int Y { get; set; }
    [Parameter] public bool IsEmpty { get; set; } = true;
    [Parameter] public BoardCell CellData { get; set; }
    [Parameter] public Guid GameId { get; set; }
    [Parameter] public Player? Player { get; set; }

    [Parameter] public int J { get; set; }
    [Parameter] public int K { get; set; }

    string fillColor = "white";
    string cursor = "arrow";

    private void OnMouseOver(MouseEventArgs e)
    {
        fillColor = "#c5dde8";

        if (!IsEmpty)
            cursor = "not-allowed";
        else
            cursor = "arrow";
    }
    private void OnMouseOut(MouseEventArgs e)
    {
        fillColor = "white";
        cursor = "arrow";
    }

    private void OnClick(MouseEventArgs e)
    {
        try
        {
            gameServiceInstance.MakeMovement(new Movement()
            {
                Player = (Player)Player,
                Position = new Position()
                {
                    X = J,
                    Y = K
                },
                Id = GameId
            });
        }
        catch
        {
            
        }
    }
}
